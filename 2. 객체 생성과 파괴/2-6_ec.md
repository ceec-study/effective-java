# 불필요한 객체 생성을 피하라

### 팩터리 메서드

똑같은 기능을 하는 인스턴스라면 매번 생성하는 것보다 하나의 인스턴스를 재사용하는 것을 고려해볼 수 있다.

특히 생성 비용이 비싼 인스턴스가 반복적으로 필요하다면 캐싱을 사용하는 것을 권장한다.

예를 들어, string.matches 메서드는 성능이 중요한 환경에서는 반복적으로 사용하기엔 적합하지 않다. Pattern 인스턴스는 한번 사용되고 가비지 컬렉션의 대상이 된다.

또한 생성 비용 또한 높다.

성능을 개선하려면 인스턴스를 static으로 선언해두고 이를 재사용하면 된다.

```java
public class RomanNumerals {
    private static final Pattern ROMAN = Pattern.comile(
        "...정규식..."
    );

    static boolean isRomanNumeral(String s) {
        return ROMAN.matcher(s).matches();
    }
}
```

이렇게 개선하면 빈번히 호출되는 상황에서 개선할 수 있다. (1.1ms -> 0.17ms)

> 만약 생성 비용이 크지만 반드시 사용되는 경우가 아니라면 지연 초기화도 고려할 수 있다. (대부분 상황에서는 그다지 추천하지 않음)


### 오토박싱

불필요한 객체를 생성하는 예시로 오토박싱도 있다.
실제로 많은 연산이 들어가는 코드에서 Interger와 int를 혼합하여서 오토박싱이 발생하는 경우 성능상 문제가 생길 수 있다.

따라서 박싱된 Wrapper 타입보다는 Primitive 타입을 사용하여 의도하지 않은 오토박싱이 들어가지 않도록 주의한다.


### 주의사항

마지막으로 데이터베이스의 커넥션 풀처럼 생성 비용이 비싼 인스턴스가 아니라 단순히 인스턴스가 자주 생성된다고 객체 풀을 만들지 않도록 주의하자.

요즘 JVM의 가비지 컬렉터는 최적화가 잘 되어있어서 직접 객체 풀을 만드는 것보다 성능이 더 좋다.

또한 방어적 복사가 필요한 상황에서 인스턴스를 재사용하였을 때의 피해가 불필요한 새로운 인스턴스를 생성했을 때보다 피해가 클 수 있다.

위 같은 상황에는 복잡하게 생각하지 말고 새로운 인스턴스를 사용하자.




