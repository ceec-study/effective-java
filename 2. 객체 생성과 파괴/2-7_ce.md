# 다 쓴 객체 참조를 해제하라

자바는 가비지 컬렉터를 통해 메모리를 관리한다.
하지만 아예 관리를 하지 않으면, 메모리 누수가 발생할 수 있다.

### 메모리 누수의 원인

메모리 누수는 다음과 같은 경우에 발생할 수 있다.

<b>1. 다 쓴 참조(obsolete reference)</b>

- 앞으로 다시 쓰지 않을 참조
- 활성 영역 밖의 참조

`문제점` - 가비지 컬렉션은 객체 참조 하나를 살려두면, 그 객체뿐만 아니라 그 객체가 참조하는 모든 객체를 회수하지 못한다. 따라서 다 쓴 참조를 회수하지 못 하게 되면 해당 객체로 인해서 수많은 객체들이 회수되지 못할 수도 있다.

`해결법` - 다 쓴 참조를 null 처리한다. (참조 해제)<br/>

객체가 비활성 영역이 되었다는 것을 가비지 컬렉터는 모른다. 따라서 프로그래머가 다 쓴 참조를 직접 null처리해서 가비지 컬렉터에게 알려야 한다.

<br/>

<b>2. 캐시</b>

`문제점` - 객체 참조를 캐시에 넣어두고, 이를 잊은 채 객체를 그대로 두는 경우 문제가 발생할 수 있다.

`해결법`

- WeakHashMap을 사용해서 캐시를 만든다. 다 쓴 엔트리는 자동으로 제거된다.
- 쓰지 않는 엔트리를 청소해준다.
  e.g. 백그라운드 스레드(ScheduledThreadPoolExecutor)

<br/>

<b>3. 리스너 혹은 콜백</b>

`문제점` - 클라이언트가 콜백만 등록하고 명확히 해지하지 않는 경우 콜백은 계속 쌓이게 된다.

`해결법` - 콜백을 약한 참조로 저장하면, GC가 즉시 수거해간다.
